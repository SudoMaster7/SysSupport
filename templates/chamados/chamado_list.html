{% extends 'base.html' %}

{% block title %}Chamados • SysSupport{% endblock %}

{% block content %}
<div class="flex items-center justify-between pb-4">
    <h1 class="text-2xl font-semibold text-slate-800">Chamados</h1>
    {% if is_gestor %}
        <a href="{% url 'chamados:criar' %}" class="inline-flex items-center gap-2 rounded bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500">
            <i class="fa-solid fa-plus"></i><span>Novo Chamado</span>
        </a>
    {% endif %}
</div>

<form method="get" class="mb-6 grid gap-4 rounded-lg bg-white p-4 shadow grid-cols-1 sm:grid-cols-2 md:grid-cols-4">
    <div>
        <label for="status" class="mb-1 block text-xs font-semibold uppercase tracking-wide">Status</label>
        <select id="status" name="status" class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
            <option value="">Todos</option>
            {% for value, label in status_choices %}
                <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="prioridade" class="mb-1 block text-xs font-semibold uppercase tracking-wide">Prioridade</label>
        <select id="prioridade" name="prioridade" class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
            <option value="">Todas</option>
            {% for value, label in prioridade_choices %}
                <option value="{{ value }}" {% if request.GET.prioridade == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="unidade" class="mb-1 block text-xs font-semibold uppercase tracking-wide">Unidade</label>
        <select id="unidade" name="unidade" class="w-full rounded border border-slate-300 px-3 py-2 text-sm">
            <option value="">Todas</option>
            {% for item in unidades %}
                <option value="{{ item.id }}" {% if request.GET.unidade == item.id|stringformat:'s' %}selected{% endif %}>{{ item.nome }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="flex items-end">
        <button type="submit" class="w-full rounded bg-slate-800 px-3 py-2 text-sm font-semibold text-white hover:bg-slate-700">Filtrar</button>
    </div>
</form>

<div class="overflow-x-auto rounded-lg bg-white shadow">
    <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
            <tr class="text-left text-xs font-semibold uppercase tracking-wide text-slate-600">
                <th class="px-4 py-3">Título</th>
                <th class="px-4 py-3">Unidade</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3">Prioridade</th>
                <th class="px-4 py-3">Tempo de Espera</th>
                <th class="px-4 py-3">Ações</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 text-sm">
            {% for chamado in chamados %}
                <tr class="hover:bg-slate-50">
                    <td class="px-4 py-3 font-medium text-slate-800">{{ chamado.titulo }}</td>
                    <td class="px-4 py-3">{{ chamado.unidade.nome }}</td>
                    <td class="px-4 py-3">
                        <span class="rounded-full bg-slate-200 px-3 py-1 text-xs font-semibold">{{ chamado.status }}</span>
                    </td>
                    <td class="px-4 py-3">{{ chamado.prioridade }}</td>
                    <td class="px-4 py-3">
                        {% if chamado.data_fechamento %}
                            {{ chamado.data_abertura|timesince:chamado.data_fechamento }}
                        {% else %}
                            {{ chamado.data_abertura|timesince }}
                        {% endif %}
                    </td>
                    <td class="px-4 py-3">
                        <a href="{% url 'chamados:detalhe' chamado.pk %}" class="text-indigo-600 hover:text-indigo-500">Ver detalhes</a>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" class="px-4 py-6 text-center text-sm text-slate-500">Nenhum chamado encontrado.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
    <div class="mt-6 flex items-center justify-between text-sm text-slate-600">
        <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        <div class="space-x-2">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="rounded bg-slate-200 px-3 py-1">Anterior</a>
            {% endif %}
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="rounded bg-slate-200 px-3 py-1">Próxima</a>
            {% endif %}
        </div>
    </div>
{% endif %}
{% endblock %}
